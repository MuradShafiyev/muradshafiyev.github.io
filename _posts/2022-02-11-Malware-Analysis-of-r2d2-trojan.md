---
title: Malware Analysis of R2D2 Trojan
published: true
---

Hi, folks.

This article basically covers the analysis of volatility sample of the R2D2 Trojan. I have alluded to the brief information about the trojan and the step-by-step analysis process of it in the following sections of this article.

<br>

## [](#header-1)About R2D2 Trojan

R2D2 is a Trojan called *‘**0zapftis**’* or *‘**Bunderstrojaner**’* (got its name from the special string embedded inside trojan’s code --> C3PO-r2d2-POE ), was announced by the Chaos Computer Club (CCC).

This Trojan targets **Windows machines** which sends an email containing an attached file or a link to the web that would then infect the computer.

German lawyer Patrick Schladt has told the media that the Trojan horse was found on the hard disk of one of his client’s computers. He was defending his client against charges related to pharmaceuticals.

The malware was allegedly installed onto the computer as it passed through customs control at Munich Airport.

The CCC were able to use forensic software to restore deleted files from the hard drive, uncovering the R2D2 Trojan horse.

The CCC [implies](http://www.ccc.de/en/updates/2011/staatstrojaner) that the malware was created for, and is being used by, German law enforcement authorities such as the BKA (Germany’s federal crime investigation agency) and LKA (state investigation bureaus). Furthermore, Schaldt claims that the Customs department was also involved in the planting of the malware.

The BKA has said that the files uncovered by the CCC, are not related to them. They are just officially denying a connection to the malware in this case. But the Trojan connects to an IP Address, 83.236.140.90, which appears to be based in Düsseldorf where LKA Nordrhein-Westfalen is. 

In January 24, 2008 WikiLeaks leaked a confidential memo (here’s [link for report](http://wikileaks.org/wiki/Skype_and_SSL_Interception_letters_-_Bavaria_-_Digitask)) between the LKA and a software firm called DigiTask.

The details leaked by WikiLeaks appear to match the behaviour of the R2D2 Trojan horse discovered by the Chaos Computer Club.

DigiTask has [given presentations](http://www.telestrategies.com/iss_europe/) in the past where it has shown off its surveillance software for monitoring Skype conversations.

Now let’s analyze the memory dump of the machine infected with R2D2 Trojan.


## [](#header-1)Analysis of the memory dump sample

For the first step we can get the information about the memory dump with the following command

```
volatility_2.6_win64_standalone.exe -f 0zapftis.vmem imageinfo
```
![](/assets/images/r2d2_1.png)

As we got the OS profile name then we can specify it with the **--profile** option and get the processes list (**pslist** option). You can also use **pstree** option to check the hierarchy of the processes

```
volatility_2.6_win64_standalone.exe -f 0zapftis.vmem --profile=WinXPSP2x86 pslist
```
![](/assets/images/r2d2_2.png)


Now let’s check the open connections and the running sockets on the machine with the following commands

```
volatility_2.6_win64_standalone.exe -f 0zapftis.vmem --profile=WinXPSP2x86 connscan
```

![](/assets/images/r2d2_3.png)

```
volatility_2.6_win64_standalone.exe -f 0zapftis.vmem --profile=WinXPSP2x86 sockets
```

![](/assets/images/r2d2_4.png)


From the screenshots above you can see that there’s a connection running with **PID 1956** using **port 1026** and communicating with **172.16.98.1**

There’s another useful plugin named cmdscan that prints out last executed commands.

![](/assets/images/r2d2_5.png)

It is obvious that the process **csrss.exe** with **PID 608** tried to start a service called ‘malware’. We can use **svcscan** plugin in order to find the exact service.

![](/assets/images/r2d2_6.png)

Now we have 2 suspicious processes that we need to take closer look at. These processes were running on **PID 608** and **PID 1956**.

Let’s take a look at the last commands that were running on the machine by adding cmdline option

![](/assets/images/r2d2_7-1.png)
![](/assets/images/r2d2_7-2.png)
![](/assets/images/r2d2_7-3.png)


We can dump the process by adding **procdump** option and specifying the directory we want to dump it to.

```
volatility_2.6_win64_standalone.exe -f 0zapftis.vmem --profile=WinXPSP2x86 procdump -p 1956 --dump-dir .
```

![](/assets/images/r2d2_8.png)


You can get the size, MAC (Modified Accessed Changed) and Hash values of the file with CFF Explorer.

![](/assets/images/r2d2_9.png)


MAC (Modified Accessed Changed) is actually in hex format on the ‘File Header’ section (**File Header -> TimeDateStamp**). You can decode it with one of the unix timestamp converters available.

![](/assets/images/r2d2_10.png)
![](/assets/images/r2d2_11.png)


Here are the PE section names

![](/assets/images/r2d2_12.png)


Some of the imported malicious functionalities from **kernel32.dll**

![](/assets/images/r2d2_13.png)


Some other malicious imports from **kernel32.dll**

createfilew, createtheread, deletefliew, exitprocess, findfirstfilew, findnextfliew, getcurrentprocess, getprocesshelp, openprocess, readfile, writefile and more this are the functions in kernel32.dll

Let’s see the scan results on **virustotal**

![](/assets/images/r2d2_14.png)

For getting the memory dump of the process we can use **memdump** option and specifying the directory

```
volatility_2.6_win64_standalone.exe -f 0zapftis.vmem --profile=WinXPSP2x86 memdump -p 1956 --dump-dir .
```

![](/assets/images/r2d2_15.png)
![](/assets/images/r2d2_16.png)

Let’s search for the suspicious IP (172.16.98.1) on the dumped memory file. As we know that R2D2 trojan records Skype conversations and keystrokes in browsers (Firefox, Opera, Internet Explorer, SeaMonkey). Now we can be sure that this is a **R2D2 trojan** the machine infected with.

![](/assets/images/r2d2_17.png)

Another evidence that proves it’s a R2D2 trojan that we can see embedded special string for those trojans.

![](/assets/images/r2d2_18.png)